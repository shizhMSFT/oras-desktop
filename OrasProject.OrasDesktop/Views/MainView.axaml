<UserControl
  x:Class="OrasProject.OrasDesktop.Views.MainView"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:OrasProject.OrasDesktop.ViewModels"
  xmlns:svc="clr-namespace:OrasProject.OrasDesktop.Services"
  xmlns:views="clr-namespace:OrasProject.OrasDesktop.Views"
  d:DesignHeight="600"
  d:DesignWidth="1000"
  x:DataType="vm:MainViewModel"
  mc:Ignorable="d">
  <Design.DataContext>
    <vm:MainViewModel />
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*,Auto,Auto">
    <!--  Row 0 & 1: Combined layout with connection spanning left columns  -->
    <Grid Grid.Row="0" Grid.RowSpan="2" ColumnDefinitions="500,*">
      
      <!-- Left side: Connection + Repositories/Tags (stacked vertically) -->
      <Grid Grid.Column="0" RowDefinitions="Auto,*">
        <!-- Connection control at top -->
        <StackPanel
          Grid.Row="0"
          Margin="10,10,5,10"
          Orientation="Horizontal"
          Spacing="10">
          <TextBlock
            Classes="section-header"
            VerticalAlignment="Center"
            Text="Registry:" />
          <views:ConnectionControl
            x:Name="ConnectionControl"
            Width="350"
            DataContext="{Binding Connection}" />
        </StackPanel>
        
        <!-- Repositories and Tags side by side -->
        <Grid Grid.Row="1" ColumnDefinitions="250,Auto,*">
          <!--  Repositories  -->
          <views:RepositorySelectorControl
            x:Name="RepositorySelectorControl"
            Grid.Column="0"
            Margin="10,0,0,0"
            DataContext="{Binding RepositorySelector}" />

          <!-- Separator between Repositories and Tags -->
          <Border 
            Grid.Column="1" 
            Width="1" 
            Margin="10,0"
            Background="{DynamicResource SystemControlForegroundBaseLowBrush}"
            Opacity="0.3" />

          <!--  Tags  -->
          <views:TagSelectorControl 
            x:Name="TagSelectorControl"
            Grid.Column="2"
            Margin="0,0,10,0"
            DataContext="{Binding TagSelector}" />
        </Grid>
      </Grid>

      <!-- Separator between Tags and Artifact Details -->
      <Border 
        Grid.Column="0" 
        Grid.RowSpan="2"
        Width="1" 
        HorizontalAlignment="Right"
        Margin="0,10,0,0"
        Background="{DynamicResource SystemControlForegroundBaseLowBrush}"
        Opacity="0.3" />

      <!-- Right side: Artifact Details Panel -->
      <views:ArtifactView
        Grid.Column="1"
        Margin="10,10,10,0"
        DataContext="{Binding Artifact}" />
    </Grid>

    <!--  Row 2: Reference  -->
    <Border
      Grid.Row="2"
      Classes="reference-bar"
      Margin="0"
      BorderThickness="0"
      Background="{DynamicResource SystemControlBackgroundChromeHighBrush}">
      <Grid 
        Margin="8,6"
        ColumnDefinitions="Auto,*,Auto,Auto">
        <StackPanel 
          Grid.Column="0" 
          Orientation="Horizontal" 
          Spacing="4"
          VerticalAlignment="Center">
          <Viewbox Width="14" Height="14" VerticalAlignment="Center">
            <Path
              Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
              Fill="#666666" />
          </Viewbox>
          <TextBlock
            FontWeight="SemiBold"
            Foreground="#666666"
            VerticalAlignment="Center"
            Text="Reference:" />
        </StackPanel>
        
        <views:ReferenceHistoryControl
          Grid.Column="1"
          Margin="8,0,0,0"
          VerticalAlignment="Center"
          DataContext="{Binding ReferenceHistory}"
          ToolTip.Tip="Press Enter to load manifest details, F4 to focus"
          Name="ReferenceHistoryControl">
          <views:ReferenceHistoryControl.KeyBindings>
            <KeyBinding Command="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).LoadManifestByReferenceCommand}" Gesture="Enter" />
          </views:ReferenceHistoryControl.KeyBindings>
        </views:ReferenceHistoryControl>
        
        <Button
          Grid.Column="2"
          Width="32"
          Height="28"
          Margin="6,0,4,0"
          Padding="0"
          Command="{Binding LoadManifestByReferenceCommand}"
          ToolTip.Tip="Search for this reference"
          VerticalAlignment="Center">
          <Path
            Width="14"
            Height="14"
            Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
            Fill="{DynamicResource ButtonForeground}"
            Stretch="Uniform" />
        </Button>
        
        <Button
          Grid.Column="3"
          Width="32"
          Height="28"
          Padding="0"
          Command="{Binding CopyReferenceCommand}"
          ToolTip.Tip="Copy reference to clipboard"
          VerticalAlignment="Center">
          <Path
            Width="14"
            Height="14"
            Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
            Fill="{DynamicResource ButtonForeground}"
            Stretch="Uniform" />
        </Button>
      </Grid>
    </Border>

    <!--  Row 3: Status bar  -->
    <views:StatusBar
      Grid.Row="3"
      DataContext="{Binding StatusBar}" />
  </Grid>
</UserControl>
