<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:OrasProject.OrasDesktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="250" d:DesignHeight="400"
             x:Class="OrasProject.OrasDesktop.Views.TagSelectorControl"
             x:DataType="vm:TagSelectorViewModel">
  
  <Grid RowDefinitions="Auto,Auto,*">
    <!-- Header -->
    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="5" Margin="0,0,0,6">
      <Path
        Width="16"
        Height="16"
        Data="M21.41,11.58L12.41,2.58C12.04,2.21 11.53,2 11,2H4A2,2 0 0,0 2,4V11C2,11.53 2.21,12.04 2.59,12.41L11.58,21.41C11.95,21.78 12.47,22 13,22C13.53,22 14.04,21.78 14.41,21.41L21.41,14.41C21.78,14.04 22,13.53 22,13C22,12.47 21.78,11.95 21.41,11.58M13,20L4,11V4H11L20,13M6.5,5A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 6.5,8A1.5,1.5 0 0,1 5,6.5A1.5,1.5 0 0,1 6.5,5Z"
        Fill="{DynamicResource SystemControlForegroundBaseMediumBrush}"
        Stretch="Uniform"
        VerticalAlignment="Center" />
      <TextBlock
        Classes="section-header"
        VerticalAlignment="Center"
        Text="Tags" />
      <Button
        Width="20"
        Height="20"
        Padding="2"
        Command="{Binding RefreshTagsCommand}"
        ToolTip.Tip="Refresh tags">
        <Path
          Width="14"
          Height="14"
          Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
          Fill="{DynamicResource ButtonForeground}"
          Stretch="Uniform" />
      </Button>
    </StackPanel>
    
    <!-- Filter TextBox -->
    <TextBox
      Grid.Row="1"
      Name="TagFilterTextBox"
      Margin="0,0,0,3"
      VerticalContentAlignment="Center"
      Watermark="Filter tags (use * for wildcards)..."
      Text="{Binding FilterText}"
      ToolTip.Tip="Filter tags by name. Press Enter to select first match. Examples: v1.* (version prefix), *-alpha (suffix match), *rc* (contains)" />
    
    <!-- Tags ListBox -->
    <ListBox
      Grid.Row="2"
      Name="TagsListBox"
      ItemsSource="{Binding Tags}"
      SelectedItem="{Binding SelectedTag, Mode=TwoWay}">
      <ListBox.KeyBindings>
        <KeyBinding Command="{Binding CopyTagCommand}" Gesture="Ctrl+C" />
      </ListBox.KeyBindings>
      <ListBox.ContextMenu>
        <ContextMenu DataContext="{Binding ContextMenu}">
          <MenuItem 
            Header="Copy Tag" 
            Command="{Binding CopyTagCommand}">
            <MenuItem.Icon>
              <PathIcon Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" />
            </MenuItem.Icon>
          </MenuItem>
          <MenuItem 
            Header="Copy Fully Qualified Reference" 
            Command="{Binding CopyFullyQualifiedReferenceCommand}">
            <MenuItem.Icon>
              <PathIcon Data="M16,1H4C2.9,1 2,1.9 2,3V17H4V3H16V1M19,5H8C6.9,5 6,5.9 6,7V21C6,22.1 6.9,23 8,23H19C20.1,23 21,22.1 21,21V7C21,5.9 20.1,5 19,5M19,21H8V7H19V21M13,9H11V13H7V15H11V19H13V15H17V13H13V9Z" />
            </MenuItem.Icon>
          </MenuItem>
        </ContextMenu>
      </ListBox.ContextMenu>
      <ListBox.ItemTemplate>
        <DataTemplate>
          <TextBlock Text="{Binding Name}" />
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </Grid>
</UserControl>
