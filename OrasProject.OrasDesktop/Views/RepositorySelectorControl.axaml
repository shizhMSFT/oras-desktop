<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:OrasProject.OrasDesktop.ViewModels"
             xmlns:models="using:OrasProject.OrasDesktop.Models"
             mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="400"
             x:Class="OrasProject.OrasDesktop.Views.RepositorySelectorControl"
             x:DataType="vm:RepositorySelectorViewModel">

  <UserControl.Styles>
    <!-- Bind TreeViewItem IsExpanded to Repository.IsExpanded -->
    <Style Selector="TreeViewItem" x:DataType="models:Repository">
      <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
    </Style>
  </UserControl.Styles>

  <Grid RowDefinitions="Auto,Auto,*">
    <!-- Header -->
    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="5" Margin="0,0,0,6">
      <Path
        Width="16"
        Height="16"
        Data="M6,2H18V8H18V8L14,12L18,16V16H18V22H6V16H6V16L10,12L6,8V8H6V2M16,16.5L12,12.5L8,16.5V20H16V16.5M12,11.5L16,7.5V4H8V7.5L12,11.5Z"
        Fill="{DynamicResource ThemeForegroundBrush}"
        Stretch="Uniform"
        VerticalAlignment="Center" />
      <TextBlock
        Classes="section-header"
        VerticalAlignment="Center"
        Text="Repositories" />
      <Button
        Width="20"
        Height="20"
        Padding="2"
        Command="{Binding RefreshCommand}"
        ToolTip.Tip="Refresh repositories">
        <Path
          Width="14"
          Height="14"
          Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
          Fill="{DynamicResource ButtonForeground}"
          Stretch="Uniform" />
      </Button>
    </StackPanel>

    <!-- Filter TextBox -->
    <TextBox
      x:Name="RepositoryFilterTextBox"
      Grid.Row="1"
      Margin="0,0,0,3"
      Watermark="Filter repositories (use * for wildcards)..."
      Text="{Binding FilterText}" />

    <!-- Repositories TreeView -->
    <TreeView
      x:Name="RepositoriesTreeView"
      Grid.Row="2"
      ItemsSource="{Binding FilteredRepositories}"
      SelectedItem="{Binding SelectedRepository, Mode=TwoWay}"
      AutoScrollToSelectedItem="True">
      <TreeView.ItemTemplate>
        <TreeDataTemplate ItemsSource="{Binding Children}">
          <TextBlock Text="{Binding Name}" />
        </TreeDataTemplate>
      </TreeView.ItemTemplate>
      <TreeView.ContextMenu>
        <ContextMenu>
          <MenuItem Header="Copy Repository Name" Command="{Binding CopyRepositoryNameCommand}" />
        </ContextMenu>
      </TreeView.ContextMenu>
    </TreeView>
  </Grid>
</UserControl>
